# Claude Code Review Action
# Automatically reviews PRs using Claude
# Copy this file to your repo's .github/workflows/ directory

name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  code-review:
    runs-on: ubuntu-latest
    name: Claude Code Review
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Run Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          
          # Review configuration
          review_mode: "diff"  # Only review changed files
          
          # Comment settings
          inline_comments: true
          summary_comment: true
          
          # Severity thresholds
          # Only comment on issues with confidence >= threshold
          confidence_threshold: 70
          
          # Focus areas
          focus_areas: |
            - Security vulnerabilities
            - Performance issues
            - Code style and best practices
            - Error handling
            - Test coverage
            - Documentation
          
          # Custom instructions
          custom_instructions: |
            This project uses the team-workflow plugin.
            Ensure code follows TDD practices.
            Check for proper error handling.
            Verify commit messages follow conventional commit format.
            
      - name: Post Review Summary
        if: always()
        run: |
          echo "## Claude Code Review Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Review has been posted as PR comments." >> $GITHUB_STEP_SUMMARY
